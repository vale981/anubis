(()=>{function k(n,t=5,e=null,o=null,a=navigator.hardwareConcurrency||1){return console.debug("fast algo"),new Promise((s,r)=>{let l=URL.createObjectURL(new Blob(["(",C(),")()"],{type:"application/javascript"})),d=[],c=()=>{d.forEach(i=>i.terminate()),e!=null&&(e.removeEventListener("abort",c),e.aborted&&(console.log("PoW aborted"),r(!1)))};e?.addEventListener("abort",c,{once:!0});for(let i=0;i<a;i++){let u=new Worker(l);u.onmessage=p=>{typeof p.data=="number"?o?.(p.data):(c(),s(p.data))},u.onerror=p=>{c(),r(p)},u.postMessage({data:n,difficulty:t,nonce:i,threads:a}),d.push(u)}URL.revokeObjectURL(l)})}function C(){return function(){let n=e=>{let o=new TextEncoder().encode(e);return crypto.subtle.digest("SHA-256",o.buffer)};function t(e){return Array.from(e).map(o=>o.toString(16).padStart(2,"0")).join("")}addEventListener("message",async e=>{let o=e.data.data,a=e.data.difficulty,s,r=e.data.nonce,l=e.data.threads,d=r;for(;;){let c=await n(o+r),i=new Uint8Array(c),u=!0;for(let h=0;h<a;h++){let B=Math.floor(h/2),j=h%2;if((i[B]>>(j===0?4:0)&15)!==0){u=!1;break}}if(u){s=t(i),console.log(s);break}let p=r;r+=l,r>p|1023&&(r>>10)%l===d&&postMessage(r)}postMessage({hash:s,data:o,difficulty:a,nonce:r})})}.toString()}function v(n,t=5,e=null,o=null,a=1){return console.debug("slow algo"),new Promise((s,r)=>{let l=URL.createObjectURL(new Blob(["(",M(),")()"],{type:"application/javascript"})),d=new Worker(l),c=()=>{d.terminate(),e!=null&&(e.removeEventListener("abort",c),e.aborted&&(console.log("PoW aborted"),r(!1)))};e?.addEventListener("abort",c,{once:!0}),d.onmessage=i=>{typeof i.data=="number"?o?.(i.data):(c(),s(i.data))},d.onerror=i=>{c(),r(i)},d.postMessage({data:n,difficulty:t}),URL.revokeObjectURL(l)})}function M(){return function(){let n=t=>{let e=new TextEncoder().encode(t);return crypto.subtle.digest("SHA-256",e.buffer).then(o=>Array.from(new Uint8Array(o)).map(a=>a.toString(16).padStart(2,"0")).join(""))};addEventListener("message",async t=>{let e=t.data.data,o=t.data.difficulty,a,s=0;do s&!1&&postMessage(s),a=await n(e+s++);while(a.substring(0,o)!==Array(o+1).join("0"));s-=1,postMessage({hash:a,data:e,difficulty:o,nonce:s})})}.toString()}var N=4,H={fast:k,slow:v},f=document.getElementById("status"),x=document.getElementById("difficulty-input"),T=document.getElementById("algorithm-select"),E=document.getElementById("compare-select"),S=document.getElementById("table-header"),U=document.getElementById("table-header-compare"),m=document.getElementById("results"),F=()=>{x.value=N;for(let n of Object.keys(H)){let t=document.createElement("option");T.append(t);let e=document.createElement("option");E.append(e),t.value=t.innerText=e.value=e.innerText=n}},A=async(n,t,e,o)=>{if(!(t>=1))throw new Error(`Invalid difficulty: ${t}`);let a=H[e];if(a==null)throw new Error(`Unknown algorithm: ${e}`);let s=new Uint8Array(32);crypto.getRandomValues(s);let r=Array.from(s).map(u=>u.toString(16).padStart(2,"0")).join(""),l=performance.now(),{hash:d,nonce:c}=await a(r,Number(t),o),i=performance.now();return console.log({hash:d,nonce:c}),n.time+=i-l,n.iters+=c,{time:i-l,nonce:c}},g={time:0,iters:0},y={time:0,iters:0},R=()=>{let n=g.iters/g.time,t=y.iters/y.time;if(Number.isFinite(n)){if(f.innerText=`Average hashrate: ${n.toFixed(3)}kH/s`,Number.isFinite(t)){let e=(n-t)/n*100;f.innerText+=` vs ${t.toFixed(3)}kH/s (${e.toFixed(2)}% change)`}}else f.innerText="Benchmarking..."},b=n=>{let t=document.createElement("td");return t.innerText=n,t.style.padding="0 0.25rem",t},I=async n=>{let t=x.value,e=T.value,o=E.value;R();try{let{time:a,nonce:s}=await A(g,t,e,n.signal),r=document.createElement("tr");r.style.display="contents",r.append(b(`${a}ms`),b(s));let l=m.scrollHeight-m.clientHeight<=m.scrollTop;if(m.append(r),l&&(m.scrollTop=m.scrollHeight-m.clientHeight),R(),o!=="NONE"){let{time:d,nonce:c}=await A(y,t,o,n.signal);r.append(b(`${d}ms`),b(c))}}catch(a){a!==!1&&(f.innerText=a);return}I(n)},w=null,L=()=>{g.time=g.iters=0,y.time=y.iters=0,m.innerHTML=f.innerText="";let n=m.parentElement;E.value!=="NONE"?(n.style.gridTemplateColumns="repeat(4,auto)",S.style.display="none",U.style.display="contents"):(n.style.gridTemplateColumns="repeat(2,auto)",S.style.display="contents",U.style.display="none"),w?.abort(),w=new AbortController,I(w)};F();x.addEventListener("change",L);T.addEventListener("change",L);E.addEventListener("change",L);L();})();
//# sourceMappingURL=bench.mjs.map
